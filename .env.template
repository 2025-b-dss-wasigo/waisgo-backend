# =========================
# Docker Compose (infra local)
# Estas variables las usa docker-compose.yml para crear los contenedores
# =========================
POSTGRES_DB=wasigo                    # Nombre de la base de datos principal
POSTGRES_USER=postgres                # Usuario superadmin de PostgreSQL
POSTGRES_PASSWORD=                    # Contraseña del superadmin (solo para docker)
WASIGO_APP_PASSWORD=                  # Contraseña para el rol wasigo_app (la app usa este)
WASIGO_MIGRATOR_PASSWORD=             # Contraseña para el rol wasigo_migrator (migraciones)

REDIS_PASSWORD=                       # Contraseña de Redis

MINIO_ROOT_USER=                      # Usuario admin de MinIO (consola web)
MINIO_ROOT_PASSWORD=                  # Contraseña admin de MinIO

# =========================
# Configuración general de la aplicación NestJS
# =========================
NODE_ENV=development                  # development | production | test
PORT=3000                             # Puerto donde corre la API
FRONTEND_URL=http://localhost:4200    # URL del frontend (para CORS y emails)
SWAGGER_ENABLED=true                  # Habilitar documentación Swagger en /api
SEED_ENABLED=true                     # Habilitar endpoint de seed para datos de prueba
LOG_JSON=false                        # true para logs JSON (Loki). En true, Swagger se apaga automaticamente.

# =========================
# Identificadores públicos
# =========================
ALLOW_UUID_IDENTIFIERS=false          # Si true, expone UUIDs internos. Si false, usa publicId

# =========================
# Base de datos PostgreSQL (conexión de la app)
# =========================
DB_HOST=localhost                     # Host de PostgreSQL
DB_PORT=5432                          # Puerto de PostgreSQL
DB_USERNAME=wasigo_app                # Usuario para operaciones CRUD (permisos limitados)
DB_PASSWORD=                          # Contraseña de wasigo_app
DB_NAME=wasigo                        # Nombre de la base de datos
DB_MIGRATION_USERNAME=wasigo_migrator # Usuario para migraciones (permisos CREATE/ALTER)
DB_MIGRATION_PASSWORD=                # Contraseña de wasigo_migrator
DB_SSL=false                          # Habilitar SSL para producción
DB_SSL_CA=                            # Ruta al certificado CA (si DB_SSL=true)

# =========================
# Base de datos de Tests (opcional)
# Solo necesario si usas una DB separada para tests
# Si no defines estas, los tests usan la DB principal (no recomendado)
# =========================
TEST_DB_HOST=localhost
TEST_DB_PORT=5432
TEST_DB_USERNAME=wasigo_app
TEST_DB_PASSWORD=
TEST_DB_NAME=wasigo_test              # Base de datos separada para tests
TEST_DB_SSL=false
TEST_DB_SSL_CA=
TEST_DB_MIGRATION_USERNAME=wasigo_migrator
TEST_DB_MIGRATION_PASSWORD=

# =========================
# JWT - Autenticación
# =========================
JWT_SECRET=                           # DEBE ser exactamente 32 caracteres para AES-256-GCM
JWT_EXPIRES_IN=15m                    # Duración del access token (ej: 15m, 1h)
JWT_REFRESH_EXPIRES_IN=7d             # Duración del refresh token (ej: 7d, 30d)
OTP_SECRET=                           # Secreto para encriptar OTPs (32 caracteres)

# =========================
# PayPal - Pagos
# =========================
PAYPAL_CLIENT_ID=                     # Client ID de tu app PayPal
PAYPAL_SECRET=                        # Secret de tu app PayPal
PAYPAL_MODE=sandbox                   # sandbox | live
PAYPAL_BASE_URL=https://api-m.sandbox.paypal.com  # Cambiar a api-m.paypal.com en producción

# =========================
# Redis - Cache y sesiones
# =========================
REDIS_HOST=localhost                  # Host de Redis
REDIS_PORT=6379                       # Puerto de Redis
# REDIS_PASSWORD ya está arriba en Docker Compose

# =========================
# Correo SMTP
# Para Gmail: habilitar "Contraseñas de aplicación"
# https://myaccount.google.com/apppasswords
# =========================
MAIL_HOST=smtp.gmail.com              # Servidor SMTP
MAIL_PORT=587                         # Puerto SMTP (587 para TLS, 465 para SSL)
MAIL_USER=                            # Email del remitente
MAIL_PASS=                            # Contraseña de aplicación (NO la contraseña normal)
MAIL_FROM="WasiGo <tu@email.com>"     # Nombre y email que aparece como remitente

# =========================
# Rate Limiting - Protección contra abuso
# =========================
THROTTLE_TTL=60000                    # Ventana de tiempo en milisegundos (60000 = 1 minuto)
THROTTLE_LIMIT=100                    # Máximo de requests por ventana de tiempo

# =========================
# Limpieza automática
# =========================
CLEANUP_UNVERIFIED_DAYS=3             # Días antes de eliminar usuarios no verificados

# =========================
# OTP - Códigos de verificación
# =========================
OTP_EXPIRATION_MINUTES=15             # Minutos antes de que expire el código
MAX_OTP_ATTEMPTS=3                    # Intentos máximos antes de bloquear
MAX_OTP_RESENDS=3                     # Reenvíos máximos permitidos

# =========================
# Seguridad - Bloqueo de cuenta
# =========================
MAX_FAILED_ATTEMPTS=5                 # Intentos fallidos antes de bloquear cuenta
BLOCK_TIME_MINUTES=15                 # Minutos de bloqueo

# =========================
# Reset de contraseña
# =========================
RESET_TOKEN_EXPIRY_MINUTES=30         # Minutos antes de que expire el link
MAX_RESET_ATTEMPTS=3                  # Intentos máximos de reset

# =========================
# Storage - Almacenamiento de archivos
# =========================
STORAGE_DRIVER=minio                  # minio (local/S3) | oci (Oracle Cloud)
STORAGE_PROFILE_BUCKET=profile-images # Bucket para fotos de perfil
STORAGE_DRIVER_BUCKET=driver-documents # Bucket para documentos de conductores

# =========================
# MinIO - Almacenamiento S3-compatible (desarrollo)
# =========================
MINIO_ENDPOINT=localhost              # Host interno para operaciones (upload, etc.)
MINIO_PUBLIC_ENDPOINT=127.0.0.1       # Host público para URLs firmadas (acceso desde navegador)
MINIO_PORT=9000                       # Puerto API S3
MINIO_USE_SSL=false                   # true en producción
MINIO_ACCESS_KEY=                     # Mismo que MINIO_ROOT_USER
MINIO_SECRET_KEY=                     # Mismo que MINIO_ROOT_PASSWORD
# NOTA: En Docker, usa MINIO_ENDPOINT=minio (nombre del servicio)

# =========================
# Oracle Cloud Infrastructure (OCI) - Producción
# Solo necesario si STORAGE_DRIVER=oci
# =========================
OCI_NAMESPACE=                        # Namespace de tu tenancy OCI
OCI_REGION=sa-saopaulo-1              # Región del bucket
OCI_CONFIG_PATH=~/.oci/config         # Ruta al archivo de configuración OCI
OCI_CONFIG_PROFILE=DEFAULT            # Perfil dentro del config

# =========================
# Identity - Desacoplamiento Auth/Business
# Estas claves son CRÍTICAS para la seguridad del sistema
# Sin ellas, no se puede correlacionar usuarios con transacciones
# =========================
IDENTITY_HASH_SECRET=                 # Secreto para HMAC-SHA256 (mínimo 32 caracteres)
IDENTITY_ENCRYPTION_KEY=              # Clave AES-256 en hex (exactamente 64 caracteres hex = 32 bytes)


# =========================
# Google Maps - Rutas
# =========================
GOOGLE_MAPS_API_KEY=                  # API Key de Google Maps Directions
GOOGLE_MAPS_BASE_URL=https://maps.googleapis.com/maps/api/directions/json

# =========================
# GUIA RAPIDA POR VARIABLE (solo produccion, MinIO onprem)
# =========================
# POSTGRES_DB=wasigo                    # Nombre de DB principal
# POSTGRES_USER=postgres                # Usuario superadmin (solo infra)
# POSTGRES_PASSWORD=                    # Password superadmin (solo infra)
# WASIGO_APP_PASSWORD=                  # Password rol app (secreto fuerte)
# WASIGO_MIGRATOR_PASSWORD=             # Password rol migraciones (secreto fuerte)
# REDIS_PASSWORD=                       # Password Redis (secreto fuerte)
# MINIO_ROOT_USER=                      # Usuario admin MinIO (solo infra)
# MINIO_ROOT_PASSWORD=                  # Password admin MinIO (solo infra)
# NODE_ENV=production                   # production en prod
# PORT=3000                             # Puerto interno
# FRONTEND_URL=https://tu-frontend.com  # URL real del frontend
# SWAGGER_ENABLED=false                 # Apaga Swagger en prod
# SEED_ENABLED=false                    # false en prod
# LOG_JSON=true                         # true para logs JSON (Loki)
# ALLOW_UUID_IDENTIFIERS=false          # false para no exponer UUIDs internos
# DB_HOST=postgres                      # Host DB (svc k8s)
# DB_PORT=5432                          # Puerto DB
# DB_USERNAME=wasigo_app                # Usuario app
# DB_PASSWORD=                          # Password app
# DB_NAME=wasigo                        # Nombre DB
# DB_MIGRATION_USERNAME=wasigo_migrator # Usuario migraciones
# DB_MIGRATION_PASSWORD=                # Password migraciones
# DB_SSL=true                           # true si DB requiere SSL
# DB_SSL_CA=                            # CA si DB_SSL=true
# JWT_SECRET=                           # 32 chars exactos
# JWT_EXPIRES_IN=15m                    # Duracion access token
# JWT_REFRESH_EXPIRES_IN=7d             # Duracion refresh token
# OTP_SECRET=                           # 32 chars (si no, usa JWT_SECRET)
# PAYPAL_CLIENT_ID=                     # Client ID real
# PAYPAL_SECRET=                        # Secret real
# PAYPAL_MODE=live                      # live en prod
# PAYPAL_BASE_URL=https://api-m.paypal.com
# REDIS_HOST=redis                      # Host Redis (svc k8s)
# REDIS_PORT=6379                       # Puerto Redis
# MAIL_HOST=smtp.proveedor.com          # SMTP real
# MAIL_PORT=587                         # Puerto SMTP
# MAIL_USER=                            # Usuario SMTP
# MAIL_PASS=                            # Password SMTP
# MAIL_FROM="WasiGo <no-reply@tu.com>"  # Remitente
# THROTTLE_TTL=60000                    # Ventana rate limit (ms)
# THROTTLE_LIMIT=100                    # Limite de requests
# CLEANUP_UNVERIFIED_DAYS=3             # Limpieza no verificados
# OTP_EXPIRATION_MINUTES=15             # Expiracion OTP
# MAX_OTP_ATTEMPTS=3                    # Intentos OTP
# MAX_OTP_RESENDS=3                     # Reenvios OTP
# MAX_FAILED_ATTEMPTS=5                 # Intentos fallidos login
# BLOCK_TIME_MINUTES=15                 # Tiempo de bloqueo
# RESET_TOKEN_EXPIRY_MINUTES=30         # Expira link reset
# MAX_RESET_ATTEMPTS=3                  # Intentos reset
# STORAGE_DRIVER=minio                  # minio en onprem
# STORAGE_PROFILE_BUCKET=profile-images # Bucket fotos
# STORAGE_DRIVER_BUCKET=driver-documents # Bucket documentos
# MINIO_ENDPOINT=minio                  # Host MinIO interno
# MINIO_PUBLIC_ENDPOINT=                # Host publico MinIO (urls)
# MINIO_PORT=9000                       # Puerto MinIO
# MINIO_USE_SSL=true                    # true si HTTPS
# MINIO_ACCESS_KEY=                     # Access key MinIO
# MINIO_SECRET_KEY=                     # Secret key MinIO
# IDENTITY_HASH_SECRET=                 # Min 32 chars
# IDENTITY_ENCRYPTION_KEY=              # 64 hex chars
# GOOGLE_MAPS_API_KEY=                  # API Key Google Maps
# GOOGLE_MAPS_BASE_URL=                 # Base URL (default directions)
